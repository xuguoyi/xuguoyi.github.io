# Event Loop

## 线程与进程
- 进程是CPU资源分配的最小单位，线程是CPU调度的最小单位
- 一个进程可以由一个或多个线程组成
- JS是单线程，指一个进程里只有一个主线程

### 多进程
是指在同一个时间里，同一个计算机系统中如果允许两个或两个以上的进程处于运行状态。多进程带来的好处是明显的，比如你可以听歌的同时，打开编辑器敲代码，编辑器和听歌软件的进程之间丝毫不会相互干扰。

### 多线程
是指程序中包含多个执行流，即在一个程序中可以同时运行多个不同的线程来执行不同的任务，也就是说允许单个程序创建多个并行执行的线程来完成各自的任务。

eg: 以Chrome浏览器中为例，当你打开一个 Tab 页时，其实就是创建了一个进程，一个进程中可以有多个线程，比如渲染线程、JS 引擎线程、HTTP 请求线程等等。当你发起一个请求时，其实就是创建了一个线程，当请求结束后，该线程可能就会被销毁。

## 浏览器主要包括的进程
#### Browser 进程：
浏览器的主进程，只有一个。
- 负责浏览器界面的显示与交互；
- 各个页面的管理，创建和销毁其他进程；
- 网络的资源管理、下载等。
#### Renderer 进程
也称为浏览器渲染进程或浏览器内核，内部是多线程的。主要负责页面渲染，脚本执行，事件处理等。
#### 第三方插件进程
每种类型的插件对应一个进程，仅当使用该插件时才创建。
#### GPU 进程
最多一个，用于 3D 绘制等。

## 浏览器内核
- 浏览器内核是通过取得页面内容、整理信息（应用CSS）、计算和组合最终输出可视化的图像结果，通常也被称为渲染引擎。
- 浏览器内核是多线程, 在内核控制下各线程相互配合以保持同步，一个浏览器通常由以下常驻线程组成：

#### GUI渲染线程
- 主要负责页面的渲染，解析HTML、CSS，构建DOM树，布局和绘制等。
- 当界面需要重绘或者由于某种操作引发回流时，将执行该线程。
- 该线程与JS引擎线程互斥，当执行JS引擎线程时，GUI渲染会被挂起，当任务队列空闲时，主线程才会去执行GUI渲染。

#### JS引擎线程
- 主要负责处理 JavaScript脚本，执行代码。
- 也是主要负责执行准备好待执行的事件，即定时器计数结束，或者异步请求成功并正确返回时，将依次进入任务队列，等待 JS引擎线程的执行。
- 当然，该线程与 GUI渲染线程互斥，当 JS引擎线程执行 JavaScript脚本时间过长，将导致页面渲染的阻塞。

#### 定时器触发线程
- 负责执行异步定时器一类的函数的线程，如： setTimeout，setInterval。
- 主线程依次执行代码时，遇到定时器，会将定时器交给该线程处理，当计数完毕后，事件触发线程会将计数完毕后的事件加入到任务队列的尾部，等待JS引擎线程执行。

#### 浏览器事件处理线程
- 将click、mouse等UI交互事件发生后，将要执行的回调函数放入到事件队列中。

#### 异步http请求线程
- 负责执行异步请求一类的函数的线程，如： Promise，axios，ajax等。
- 主线程依次执行代码时，遇到异步请求，会将函数交给该线程处理，当监听到状态码变更，如果有回调函数，事件触发线程会将回调函数加入到任务队列的尾部，等待JS引擎线程执行。