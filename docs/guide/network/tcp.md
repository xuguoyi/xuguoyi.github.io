# TCP

## 核心特征
1. 面向连接： 指的是客户端和服务器的连接，在双方互相通信之前，TCP 需要三次握手建立连接
2. 可靠性： 保证连接的可靠
3. 面向字节流： TCP 为了维护状态，将一个个 IP 包变成了字节流。

## 如何保证可靠性
- 分块传送：数据被分割成最合适的数据块（UDP的数据报长度不变）
- 等待确认：通过定时器等待接收端发送确认请求，收不到确认则重发
- 确认回复：收到确认后发送确认回复(不是立即发送，通常推迟几分之一秒)
- 数据校验：保持首部和数据的校验和，检测数据传输过程有无变化
- 乱序排序：接收端能重排序数据，以正确的顺序交给应用端
- 重复丢弃：接收端能丢弃重复的数据包
- 流量缓冲：两端有固定大小的缓冲区（滑动窗口），防止速度不匹配丢数据

## 三次握手
1. 客户端发生SYN，表明要向服务器建立连接，同时带上序列号ISN
2. 服务器返回ACK(序号为客户端序列号+1)作为确认。同时发送SYN作为应答（SYN的序列号为服务端唯一的序号）。
3. 客户端发送ACK确认收到回复（序列号为服务端序列号+1）

## 为什么是三次握手
因为TCP链接是全双工的，数据在两个方向上能同时传递。所以需要确保双方的收发能力：
1. 第一次握手确认了客户端的发送能力
2. 第二次握手确认了服务端的发送和接收能力
3. 第三次握手确认了客户端的接收能力